# test-semrush-sower

### Исходное задание
Исходное задание расположено в файле [ASSIGNMENT.md](ASSIGNMENT.md)

### Дисклаймер
Немного изменил условия задачи, а именно
 - мастеру не обязательно заранее знать порты слэйвов
 - попытки прокинуть на слэйв повторяем с задержкой 2 сек и множителем 1.2
 - максимальный интервал повторения ограничен 300 секундами
 
### Предварительное требование
Java 8

## Как запустить

Склонировать репозиторий, перейти в папку test-semrush-sower.
Дальнейшие действия выполнять, находясь в этой папке.

!ВНИМАНИЕ! Перед первым запуском выполнить общую очистку
`gradle clean`

### Мастер

`./gradlew master:bootRun`

подождать, пока прогреется )
то есть пока в консоли не появится надпись `Started Eureka Server`

### Слэйвы
`./gradlew slave:bootRun -PjvmArgs="-Dserver.port=9999 -Dsower.blink=true -Dsower.snail=true"`

,где
 – server.port – номер желаемого порта
 – sower.blink – режим мерцания (необязательный, по умолчанию false)
 – sower.snail – режим тупняка (необязательный, по умолчанию false)

> Режим мерцания – это когда выполняется  `if (Math.random() > 0.2) throw new Exception();`

> Режим тупняка – это когда выполняется  `Thread.sleep((long) (Math.random() * 10000));`

подождать какое-то время, пока дискавери подцепит слэйв.

понять это можно будет по надписи `Registered instance id localhost:slave 9999 with status UP`

## Как следить
Для просмотреа агрегированной статистики хистрикса можно перейти по ссылке

http://localhost:8080/monitor

Начинает что-то показывать только после того, как пошли запросы.

А сотояние обнаруженных/подключенных сервисов, стандартно, по ссылке

http://localhost:8080/

## Как примерно работает
Мастер представляет собой в том числе дискавери-сервис, в котором автоматически регистрируются слэйвы.

При создании/апдейте проекта мастер пытается разослать обновления всем зарегистрированным слэйвам с помощью хистрикс-команды, используя RestTemplate.
